---
title: "Statistical Analysis: By Block & Target"
output: html_document
date: "2023-10-01"
---

```{r global-options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r loading libraries, include=FALSE}
# This code chunk loads various libraries necessary to complete the data analysis and produce graphics
library(tidyverse)
library(stringr)
library(ez)
library(cowplot)
library(viridis)
library(viridisLite)
library("readxl")
library("ggcorrplot")
library(dplyr)
library(ltm)
library(plotrix)
library("viridis")
library("paletteer")
library(corrplot)
library(ggplot2)
```

```{r reading data, include=FALSE}
#This loads the data file as the variable "data"
nav_data <- read.csv('/Users/yasminebassil/Desktop/Data/merged_results.csv')
# Tidying up the data
names(nav_data)[1] <- 'index'
names(nav_data)[2] <- 'Participant'
names(nav_data)[3] <- 'Block_num'
names(nav_data)[4] <- 'Target_Name'
names(nav_data)[5] <- 'Total_Time'
names(nav_data)[6] <- 'Orientation_Time'
names(nav_data)[7] <- 'Navigation_Time'
names(nav_data)[8] <- 'Distance'
names(nav_data)[9] <- 'Speed'
names(nav_data)[10] <- 'Mean_Dwell'
names(nav_data)[11] <- 'Var_X'
names(nav_data)[12] <- 'Var_Y'
names(nav_data)[13] <- 'Var_Z'
names(nav_data)[14] <- 'Teleportations'
nav_data <- nav_data[ -c(1) ]
nav_data$Block_num <- as.factor(nav_data$Block_num)
sapply(nav_data, class)

desired_order <- c("Automobile shop", "Police station ", "Fire Station", "Bank", "Pawn Shop", "Pizzeria", "Quattroki Restaurant", "High School")
# Reorder the levels of Target_Name
nav_data$Target_Name <- factor(nav_data$Target_Name, levels = desired_order)

#This loads the data file as the variable "data"
non_nav_data <- read.csv('/Users/yasminebassil/Desktop/Data/non_nav_data.csv')
# Tidying up the data
names(non_nav_data)[1] <- 'Participant'
names(non_nav_data)[2] <- 'Age'
names(non_nav_data)[3] <- 'PSQI'
names(non_nav_data)[4] <- 'SSS_Pre'
names(non_nav_data)[5] <- 'SSS_Post'
names(non_nav_data)[6] <- 'SBSOD'
names(non_nav_data)[7] <- 'MiniCog'
names(non_nav_data)[8] <- 'TrailsA'
names(non_nav_data)[9] <- 'TrailsB'
names(non_nav_data)[10] <- 'SetShifting'
names(non_nav_data)[11] <- 'CorsiBlocks'
names(non_nav_data)[12] <- 'SSQ_Pre'
names(non_nav_data)[13] <- 'SSQ_Post'
names(non_nav_data)[14] <- 'NARA'
non_nav_data <- head(non_nav_data, n=23)
```

```{r organizing data, include=FALSE}
b1 <- subset(nav_data, Block_num == 1)
rownames(b1) <- NULL 
b2 <- subset(nav_data, Block_num == 2)
rownames(b2) <- NULL 
b3 <- subset(nav_data, Block_num == 3)
rownames(b3) <- NULL 

change <- subset(b3, select = c(Participant, Target_Name))

for (i in 1:nrow(b3)) {
  change$Total_Time[i] <- b3$Total_Time[i] - b1$Total_Time[i]
  change$Orientation_Time[i] <- b3$Orientation_Time[i] - b1$Orientation_Time[i]
  change$Navigation_Time[i] <- b3$Navigation_Time[i] - b1$Navigation_Time[i]
  change$Distance[i] <- b3$Distance[i] - b1$Distance[i]
  change$Speed[i] <- b3$Speed[i] - b1$Speed[i]
  change$Mean_Dwell[i] <- b3$Mean_Dwell[i] - b1$Mean_Dwell[i]
  change$Var_X[i] <- b3$Var_X[i] - b1$Var_X[i]
  change$Var_Y[i] <- b3$Var_Y[i] - b1$Var_Y[i]
  change$Var_Z[i] <- b3$Var_Z[i] - b1$Var_Z[i]
  change$Teleportations[i] <- b3$Teleportations[i] - b1$Teleportations[i]
}

b1$Target_Name <- factor(b1$Target_Name, levels = desired_order)
b2$Target_Name <- factor(b2$Target_Name, levels = desired_order)
b3$Target_Name <- factor(b3$Target_Name, levels = desired_order)
change$Target_Name <- factor(change$Target_Name, levels = desired_order)
```

# Linear Mixed Model

To use a linear mixed model, the relationship between your response variable 
and your explanatory variable is assumed to be linear. However, this is not the
case in our data. As you can see below, if you conduct a basic linear regression, 
and you plot the residuals or plot a Q-Q plot, the data doesn't necessarily 
look like it should. Therefore, I'm not sure we can use a linear mixed model here.


However, let's run it anyways and see what happens.

```{r stats lm}
basic.lm <- lm(Distance ~ Block_num, data = nav_data)
summary(basic.lm)
```

Now that we've done that, we can plot a preliminary plot: Distance by Block. 
This should be a linear relationship. This is helpful to see if we can actually
use a linear mixed model (or any linear regression model anyways). 

Even though we see a linear-ish trend below, I'm unsure if the explanatory variable
has to be a continuous variable (and not categorical, like Block is). This is
my main question. 

```{r p_prelim}
prelim_plot <- ggplot(nav_data, aes(x = Block_num, y = Distance)) +
  geom_point() +
  geom_smooth(method = "lm")
prelim_plot
```

Below, we plot the residuals. The line should ideally be flat, which it is.
This assumption passes, under the condition that the explanatory variable can be
categorical (which I'm actually not sure it can be). 

```{r p_residuals}
plot(basic.lm, which = 1)
```

Below, we plot a Q-Q plot. The dots should lie along the line. Here, you see that this
is not the case. This assumption fails. 

```{r p_qq}
plot(basic.lm, which = 2) 
```

Since there's not necessarily a directly linear relationship between our variables, 
and our explanatory variable is categorical, I'm not sure we can use a linear
mixed model. 

# Two-Way Nested ANOVA

Instead of a linear mixed model, we can utilize a Two-Way Nested ANOVA. A Two-Way 
Nested ANOVA (also known as Nested Analysis of Variance) is designed for 
situations where you have two categorical independent variables, one of which 
is nested within the other (like Block and Trial). 

Below is the two-way nested ANOVA.

```{r stats anova}
nest <- aov(nav_data$Distance ~ nav_data$Block_num / factor(nav_data$Target_Name))
summary(nest)
```


Here's a prelim plot that visually shows the comparisons we're making above.

```{r}
ggplot(nav_data, aes(x=factor(Target_Name), y=Distance, fill=Block_num))+
  geom_boxplot()
```